<script setup>

import OperatorSetupFlow from "@/components/OperatorSetup/Flow.vue"

import { useOperatorStore, usePermissions, useRecordStore } from "@/stores/index.js"
import { defineAsyncComponent, markRaw } from "vue"
import ActionFromSource from "@/components/OperatorSetup/Actions/FromSource.vue"
import { sources } from "@/referentiels/imports.js"
import { storeToRefs } from "pinia"

const operatorStore = useOperatorStore()
const recordStore = useRecordStore()
const permissions = usePermissions()
const { operator } = storeToRefs(operatorStore)
const { record } = storeToRefs(recordStore)

const operatorSetupActions = [
  {
    id: 'source',
    selector: markRaw(ActionFromSource),
    wizzard: defineAsyncComponent(() => import('@/components/OperatorSetup/Flows/MultiSources.vue')),
    extraProps: {
      sources: [sources.GEOFOLIA, sources.MESPARCELLES, sources.TELEPAC, ...(permissions.isOc ? [sources.RPG] : []), sources.CVI]
    }
  },
]
</script>

<template>
  <section class="fr-container fr-py-2w">
    <nav role="navigation" class="fr-breadcrumb">
      <ol class="fr-breadcrumb__list">
        <li><router-link class="fr-breadcrumb__link" :to="permissions.startPage">Exploitations</router-link></li>
        <li><router-link class="fr-breadcrumb__link" :to="`/exploitations/${operator.numeroBio}`">{{ operator.nom }}</router-link></li>
        <li><a class="fr-breadcrumb__link" aria-current="page">Importer un parcellaire informatisé</a></li>
      </ol>
    </nav>

    <h1 class="fr-h1">Importer un parcellaire informatisé</h1>

    <OperatorSetupFlow
        :operator="operatorStore.operator"
        :actions="operatorSetupActions"
        with-stepper
        flow-id="source"
        @redirect="$router.push(`/exploitations/${operator.numeroBio}/${record.record_id}`)"
    >
      <template #introduction>
        <p class="fr-text--lg" v-if="permissions.isAgri">
          Nous vous demandons quelques informations lors
          d'une <em>première utilisation</em> de CartoBio.
        </p>
        <p class="fr-h6" v-if="permissions.isAgri">
          Choisir votre mode de création de parcellaire :
        </p>
      </template>
    </OperatorSetupFlow>
  </section>

</template>

<style scoped>

</style>
