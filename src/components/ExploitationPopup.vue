<template>
  <MglPopup :showed="!show" :close-button="false" :offset="[0,-10]" :coordinates="coordinates" @open="onPopupOpened">
    <article class="exploitation">
      <h3 class="headline mb-2">{{ props.nom }}</h3>

      <p v-if="props.date_engagement"><v-chip small color="#b9d065">Engagé depuis {{ props.date_engagement | dateFormat }}</v-chip></p>
      <p v-else><v-chip small color="grey lighten-2">Date d'engagement inconnue</v-chip></p>

      <v-divider />

      <p class="py-2 pb-0 ma-0">Numéro Pacage : <b>{{ props.pacage }}</b></p>
    </article>
  </MglPopup>
</template>

<script>
import {MglPopup} from "vue-mapbox"
import getObjectValue from "lodash/get"

export default {
  name: "ExploitationPopup",
  props: ['feature', 'operator'],

  components: {
    MglPopup
  },

  methods: {
    onPopupOpened ({ popup }) {
      popup.setMaxWidth('380px')
    }
  },

  filters: {
    dateFormat: (dateString) => new Date(dateString).toLocaleDateString('fr-FR', { year: 'numeric', month: 'long'}),
  },

  computed: {
    props () {
      return getObjectValue(this.operator, ['properties'], {})
    },

    coordinates () {
      return getObjectValue(this.feature, ['geometry', 'coordinates'], [0, 0])
    },

    show () {
      return Boolean(this.feature && this.feature.id)
    },
  }
};
</script>

<style lang="scss" scoped>
$cell-padding: 10px;

.exploitation {
  width: 280px;
}

.v-chip {
  margin: 0;
}
</style>
